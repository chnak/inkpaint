{"version":3,"sources":["../../../src/filters/displacement/DisplacementFilter.js"],"names":["DisplacementFilter","Filter","constructor","sprite","scale","maskMatrix","Matrix","renderable","maskSprite","uniforms","mapSampler","_texture","filterMatrix","x","y","undefined","setScale","Point","apply","filterManager","input","output","calculateSpriteMatrix","map","value"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AAEA;;;;AAEe,MAAMA,kBAAN,SAAiCC,eAAjC,CAAwC;AACrDC,EAAAA,WAAW,CAACC,MAAD,EAASC,KAAT,EAAgB;AACzB,QAAMC,UAAU,GAAG,IAAIC,eAAJ,EAAnB;AAEAH,IAAAA,MAAM,CAACI,UAAP,GAAoB,KAApB;AAEA,WACE;AADF,sZAGE;AAHF;AAOA,SAAKC,UAAL,GAAkBL,MAAlB;AACA,SAAKE,UAAL,GAAkBA,UAAlB;AAEA,SAAKI,QAAL,CAAcC,UAAd,GAA2BP,MAAM,CAACQ,QAAlC;AACA,SAAKF,QAAL,CAAcG,YAAd,GAA6BP,UAA7B;AACA,SAAKI,QAAL,CAAcL,KAAd,GAAsB;AAAES,MAAAA,CAAC,EAAE,CAAL;AAAQC,MAAAA,CAAC,EAAE;AAAX,KAAtB;;AAEA,QAAIV,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAKW,SAAhC,EAA2C;AACzCX,MAAAA,KAAK,GAAG,EAAR;AACD;;AAED,SAAKY,QAAL,CAAcZ,KAAd,EAAqBA,KAArB;AACD;;AAEDY,EAAAA,QAAQ,CAACH,CAAD,EAAIC,CAAJ,EAAO;AACb,SAAKV,KAAL,GAAa,IAAIa,cAAJ,CAAUJ,CAAV,EAAaC,CAAb,CAAb;AACD;;AAEDI,EAAAA,KAAK,CAACC,aAAD,EAAgBC,KAAhB,EAAuBC,MAAvB,EAA+B;AAClC,SAAKZ,QAAL,CAAcG,YAAd,GAA6BO,aAAa,CAACG,qBAAd,CAC3B,KAAKjB,UADsB,EAE3B,KAAKG,UAFsB,CAA7B;AAIA,SAAKC,QAAL,CAAcL,KAAd,CAAoBS,CAApB,GAAwB,KAAKT,KAAL,CAAWS,CAAnC;AACA,SAAKJ,QAAL,CAAcL,KAAd,CAAoBU,CAApB,GAAwB,KAAKV,KAAL,CAAWU,CAAnC;AACA,UAAMI,KAAN,CAAYC,aAAZ,EAA2BC,KAA3B,EAAkCC,MAAlC;AACD;;AAEM,MAAHE,GAAG,GAAG;AACR,WAAO,KAAKd,QAAL,CAAcC,UAArB;AACD;;AAEM,MAAHa,GAAG,CAACC,KAAD,EAAQ;AACb,SAAKf,QAAL,CAAcC,UAAd,GAA2Bc,KAA3B;AACD;;AA/CoD","sourcesContent":["import Filter from \"../../renderers/webgl/filters/Filter\";\nimport Matrix from \"../../math/Matrix\";\nimport Point from \"../../math/Point\";\nimport { readFileSync } from \"fs\";\nimport { join } from \"path\";\n\nexport default class DisplacementFilter extends Filter {\n  constructor(sprite, scale) {\n    const maskMatrix = new Matrix();\n\n    sprite.renderable = false;\n\n    super(\n      // vertex shader\n      readFileSync( join(__dirname, \"../fragments/default-filter-matrix.vert\"), \"utf8\"),\n      // fragment shader\n      readFileSync(join(__dirname, \"./displacement.frag\"), \"utf8\")\n    );\n\n    this.maskSprite = sprite;\n    this.maskMatrix = maskMatrix;\n\n    this.uniforms.mapSampler = sprite._texture;\n    this.uniforms.filterMatrix = maskMatrix;\n    this.uniforms.scale = { x: 1, y: 1 };\n\n    if (scale === null || scale === undefined) {\n      scale = 20;\n    }\n\n    this.setScale(scale, scale);\n  }\n\n  setScale(x, y) {\n    this.scale = new Point(x, y);\n  }\n\n  apply(filterManager, input, output) {\n    this.uniforms.filterMatrix = filterManager.calculateSpriteMatrix(\n      this.maskMatrix,\n      this.maskSprite\n    );\n    this.uniforms.scale.x = this.scale.x;\n    this.uniforms.scale.y = this.scale.y;\n    super.apply(filterManager, input, output);\n  }\n\n  get map() {\n    return this.uniforms.mapSampler;\n  }\n\n  set map(value) {\n    this.uniforms.mapSampler = value;\n  }\n}\n"],"file":"DisplacementFilter.js"}