{"version":3,"sources":["../../../src/renderers/webgl/WebGLState.js"],"names":["BLEND","DEPTH_TEST","FRONT_FACE","CULL_FACE","BLEND_FUNC","WebGLState","constructor","gl","activeState","Uint8Array","defaultState","stackIndex","stack","maxAttribs","getParameter","MAX_VERTEX_ATTRIBS","attribState","tempAttribState","Array","blendModes","nativeVaoExtension","getExtension","push","state","i","length","pop","setState","setBlend","setDepthTest","setFrontFace","setCullFace","setBlendMode","value","mode","blendFunc","blendFuncSeparate","frontFace","resetAttributes","disableVertexAttribArray","resetToDefault","bindVertexArrayOES","pixelStorei","UNPACK_FLIP_Y_WEBGL"],"mappings":"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","sourcesContent":["import mapWebGLBlendModesToPixi from \"./utils/mapWebGLBlendModesToPixi\";\n\nconst BLEND = 0;\nconst DEPTH_TEST = 1;\nconst FRONT_FACE = 2;\nconst CULL_FACE = 3;\nconst BLEND_FUNC = 4;\n\nexport default class WebGLState {\n  constructor(gl) {\n    this.activeState = new Uint8Array(16);\n    this.defaultState = new Uint8Array(16);\n    this.defaultState[0] = 1;\n    this.stackIndex = 0;\n    this.stack = [];\n    this.gl = gl;\n\n    this.maxAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n    this.attribState = {\n      tempAttribState: new Array(this.maxAttribs),\n      attribState: new Array(this.maxAttribs)\n    };\n\n    this.blendModes = mapWebGLBlendModesToPixi(gl);\n    this.nativeVaoExtension =\n      gl.getExtension(\"OES_vertex_array_object\") ||\n      gl.getExtension(\"MOZ_OES_vertex_array_object\") ||\n      gl.getExtension(\"WEBKIT_OES_vertex_array_object\");\n  }\n\n  push() {\n    let state = this.stack[this.stackIndex];\n\n    if (!state) {\n      state = this.stack[this.stackIndex] = new Uint8Array(16);\n    }\n\n    ++this.stackIndex;\n    for (let i = 0; i < this.activeState.length; i++) {\n      state[i] = this.activeState[i];\n    }\n  }\n\n  pop() {\n    const state = this.stack[--this.stackIndex];\n    this.setState(state);\n  }\n\n  setState(state) {\n    this.setBlend(state[BLEND]);\n    this.setDepthTest(state[DEPTH_TEST]);\n    this.setFrontFace(state[FRONT_FACE]);\n    this.setCullFace(state[CULL_FACE]);\n    this.setBlendMode(state[BLEND_FUNC]);\n  }\n\n  setBlend(value) {\n    value = value ? 1 : 0;\n    if (this.activeState[BLEND] === value) {\n      return;\n    }\n\n    this.activeState[BLEND] = value;\n    this.gl[value ? \"enable\" : \"disable\"](this.gl.BLEND);\n  }\n\n  setBlendMode(value) {\n    if (value === this.activeState[BLEND_FUNC]) {\n      return;\n    }\n\n    this.activeState[BLEND_FUNC] = value;\n\n    const mode = this.blendModes[value];\n\n    if (mode.length === 2) {\n      this.gl.blendFunc(mode[0], mode[1]);\n    } else {\n      this.gl.blendFuncSeparate(mode[0], mode[1], mode[2], mode[3]);\n    }\n  }\n\n  setDepthTest(value) {\n    value = value ? 1 : 0;\n\n    if (this.activeState[DEPTH_TEST] === value) {\n      return;\n    }\n\n    this.activeState[DEPTH_TEST] = value;\n    this.gl[value ? \"enable\" : \"disable\"](this.gl.DEPTH_TEST);\n  }\n\n  setCullFace(value) {\n    value = value ? 1 : 0;\n\n    if (this.activeState[CULL_FACE] === value) {\n      return;\n    }\n\n    this.activeState[CULL_FACE] = value;\n    this.gl[value ? \"enable\" : \"disable\"](this.gl.CULL_FACE);\n  }\n\n  setFrontFace(value) {\n    value = value ? 1 : 0;\n\n    if (this.activeState[FRONT_FACE] === value) {\n      return;\n    }\n\n    this.activeState[FRONT_FACE] = value;\n    this.gl.frontFace(this.gl[value ? \"CW\" : \"CCW\"]);\n  }\n\n  resetAttributes() {\n    for (let i = 0; i < this.attribState.tempAttribState.length; i++) {\n      this.attribState.tempAttribState[i] = 0;\n    }\n\n    for (let i = 0; i < this.attribState.attribState.length; i++) {\n      this.attribState.attribState[i] = 0;\n    }\n\n    // im going to assume one is always active for performance reasons.\n    for (let i = 1; i < this.maxAttribs; i++) {\n      this.gl.disableVertexAttribArray(i);\n    }\n  }\n\n  resetToDefault() {\n    // unbind any VAO if they exist..\n    if (this.nativeVaoExtension) {\n      this.nativeVaoExtension.bindVertexArrayOES(null);\n    }\n\n    // reset all attributes..\n    this.resetAttributes();\n\n    // set active state so we can force overrides of gl state\n    for (let i = 0; i < this.activeState.length; ++i) {\n      this.activeState[i] = 32;\n    }\n\n    this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, false);\n\n    this.setState(this.defaultState);\n  }\n}\n"],"file":"WebGLState.js"}