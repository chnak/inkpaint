{"version":3,"sources":["../../src/text/Text.js"],"names":["defaultDestroyOptions","texture","children","baseTexture","Text","Sprite","constructor","text","style","canvas","Doc","createElement","width","height","Texture","fromCanvas","settings","SCALE_MODE","orig","Rectangle","trim","_texture","textureCacheIds","context","getContext","resolution","RESOLUTION","_text","_style","_styleListener","_font","localStyleID","updateText","respectDirty","styleID","dirty","toFontString","measured","TextMetrics","measureText","wordWrap","lines","lineHeight","lineWidths","maxLineWidth","fontProperties","Math","ceil","max","padding","scale","clearRect","drawBackground","font","strokeStyle","stroke","lineWidth","strokeThickness","textBaseline","lineJoin","miterLimit","linePositionX","linePositionY","dropShadow","fillStyle","dropShadowColor","globalAlpha","dropShadowAlpha","shadowBlur","dropShadowBlur","shadowColor","xShadowOffset","cos","dropShadowAngle","dropShadowDistance","yShadowOffset","sin","i","length","ascent","align","fill","drawLetterSpacing","_generateFillStyle","updateTexture","background","backgroundColor","ftext","String","fillRect","x","y","isStroke","letterSpacing","strokeText","fillText","characters","prototype","split","call","currentPosition","index","current","previousWidth","currentWidth","substring","updateStyle","key","newKey","camelCase","name","SPECIAL_CHARS_REGEXP","MOZ_HACK_REGEXP","replace","_","separator","letter","offset","toUpperCase","trimmed","data","putImageData","hasLoaded","realWidth","realHeight","_frame","_onTextureUpdate","emit","renderWebGL","renderer","_renderCanvas","getLocalBounds","rect","_calculateBounds","calculateVertices","_bounds","addQuad","vertexData","_onStyleChange","Array","isArray","gradient","totalIterations","currentIteration","stop","slice","fillGradientStops","lengthPlus1","push","unshift","fillGradientType","TEXT_GRADIENT","LINEAR_VERTICAL","createLinearGradient","j","addColorStop","destroy","options","destroyed","Object","assign","abs","value","s","_width","_height","TextStyle","undefined"],"mappings":"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","sourcesContent":["import Sprite from \"../sprites/Sprite\";\nimport Texture from \"../textures/Texture\";\nimport { sign } from \"../utils\";\nimport { Rectangle } from \"../math\";\nimport { TEXT_GRADIENT } from \"../const\";\nimport settings from \"../settings\";\nimport TextStyle from \"./TextStyle\";\nimport TextMetrics from \"./TextMetrics\";\nimport trimCanvas from \"../utils/trimCanvas\";\nimport Doc from \"../polyfill/Doc\";\nimport { addToTextureCache } from \"../utils/cache\";\n\nconst defaultDestroyOptions = {\n  texture: true,\n  children: false,\n  baseTexture: true\n};\n\nexport default class Text extends Sprite {\n  constructor(text, style, canvas) {\n    canvas = canvas || Doc.createElement(\"canvas\");\n    canvas.width = 3;\n    canvas.height = 3;\n\n    const texture = Texture.fromCanvas(canvas, settings.SCALE_MODE, \"text\");\n    texture.orig = new Rectangle();\n    texture.trim = new Rectangle();\n\n    super(texture);\n    addToTextureCache(\n      this._texture,\n      this._texture.baseTexture.textureCacheIds[0]\n    );\n\n    this.canvas = canvas;\n    this.context = this.canvas.getContext(\"2d\");\n    this.resolution = settings.RESOLUTION;\n    this._text = null;\n    this._style = null;\n    this._styleListener = null;\n    this._font = \"\";\n    this.text = text;\n    this.style = style;\n    this.localStyleID = -1;\n  }\n\n  updateText(respectDirty) {\n    const style = this._style;\n\n    if (this.localStyleID !== style.styleID) {\n      this.dirty = true;\n      this.localStyleID = style.styleID;\n    }\n\n    if (!this.dirty && respectDirty) {\n      return;\n    }\n\n    this._font = this._style.toFontString();\n\n    const context = this.context;\n    const measured = TextMetrics.measureText(\n      this._text,\n      this._style,\n      this._style.wordWrap,\n      this.canvas\n    );\n    const width = measured.width;\n    const height = measured.height;\n    const lines = measured.lines;\n    const lineHeight = measured.lineHeight;\n    const lineWidths = measured.lineWidths;\n    const maxLineWidth = measured.maxLineWidth;\n    const fontProperties = measured.fontProperties;\n\n    this.canvas.width = Math.ceil(\n      (Math.max(1, width) + style.padding * 2) * this.resolution\n    );\n    this.canvas.height = Math.ceil(\n      (Math.max(1, height) + style.padding * 2) * this.resolution\n    );\n\n    context.scale(this.resolution, this.resolution);\n    context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    this.drawBackground(style);\n\n    context.font = this._font;\n    context.strokeStyle = style.stroke;\n    context.lineWidth = style.strokeThickness;\n    context.textBaseline = style.textBaseline;\n    context.lineJoin = style.lineJoin;\n    context.miterLimit = style.miterLimit;\n\n    let linePositionX;\n    let linePositionY;\n\n    if (style.dropShadow) {\n      context.fillStyle = style.dropShadowColor;\n      context.globalAlpha = style.dropShadowAlpha;\n      context.shadowBlur = style.dropShadowBlur;\n\n      if (style.dropShadowBlur > 0) {\n        context.shadowColor = style.dropShadowColor;\n      }\n\n      const xShadowOffset =\n        Math.cos(style.dropShadowAngle) * style.dropShadowDistance;\n      const yShadowOffset =\n        Math.sin(style.dropShadowAngle) * style.dropShadowDistance;\n\n      for (let i = 0; i < lines.length; i++) {\n        linePositionX = style.strokeThickness / 2;\n        linePositionY =\n          style.strokeThickness / 2 + i * lineHeight + fontProperties.ascent;\n\n        if (style.align === \"right\") {\n          linePositionX += maxLineWidth - lineWidths[i];\n        } else if (style.align === \"center\") {\n          linePositionX += (maxLineWidth - lineWidths[i]) / 2;\n        }\n\n        if (style.fill) {\n          this.drawLetterSpacing(\n            lines[i],\n            linePositionX + xShadowOffset + style.padding,\n            linePositionY + yShadowOffset + style.padding\n          );\n\n          if (style.stroke && style.strokeThickness) {\n            context.strokeStyle = style.dropShadowColor;\n            this.drawLetterSpacing(\n              lines[i],\n              linePositionX + xShadowOffset + style.padding,\n              linePositionY + yShadowOffset + style.padding,\n              true\n            );\n            context.strokeStyle = style.stroke;\n          }\n        }\n      }\n    }\n\n    context.shadowBlur = 0;\n    context.globalAlpha = 1;\n    context.fillStyle = this._generateFillStyle(style, lines);\n\n    // draw lines line by line\n    for (let i = 0; i < lines.length; i++) {\n      linePositionX = style.strokeThickness / 2;\n      linePositionY =\n        style.strokeThickness / 2 + i * lineHeight + fontProperties.ascent;\n\n      if (style.align === \"right\") {\n        linePositionX += maxLineWidth - lineWidths[i];\n      } else if (style.align === \"center\") {\n        linePositionX += (maxLineWidth - lineWidths[i]) / 2;\n      }\n\n      if (style.stroke && style.strokeThickness) {\n        this.drawLetterSpacing(\n          lines[i],\n          linePositionX + style.padding,\n          linePositionY + style.padding,\n          true\n        );\n      }\n\n      if (style.fill) {\n        this.drawLetterSpacing(\n          lines[i],\n          linePositionX + style.padding,\n          linePositionY + style.padding\n        );\n      }\n    }\n\n    this.updateTexture();\n  }\n\n  drawBackground(style) {\n    const background = style.background || style.backgroundColor;\n    if (!background) return;\n\n    const { context, canvas, text } = this;\n    const ftext = String(text).trim();\n    if (ftext) {\n      context.fillStyle = background;\n      context.fillRect(0, 0, canvas.width, canvas.height);\n    } else {\n      context.clearRect(0, 0, canvas.width, canvas.height);\n    }\n  }\n\n  drawLetterSpacing(text, x, y, isStroke = false) {\n    const style = this._style;\n\n    // letterSpacing of 0 means normal\n    const letterSpacing = style.letterSpacing;\n\n    if (letterSpacing === 0) {\n      if (isStroke) {\n        this.context.strokeText(text, x, y);\n      } else {\n        this.context.fillText(text, x, y);\n      }\n\n      return;\n    }\n\n    const characters = String.prototype.split.call(text, \"\");\n    let currentPosition = x;\n    let index = 0;\n    let current = \"\";\n    let previousWidth = this.context.measureText(text).width;\n    let currentWidth = 0;\n\n    while (index < text.length) {\n      current = characters[index++];\n      if (isStroke) {\n        this.context.strokeText(current, currentPosition, y);\n      } else {\n        this.context.fillText(current, currentPosition, y);\n      }\n\n      currentWidth = this.context.measureText(text.substring(index)).width;\n      currentPosition += previousWidth - currentWidth + letterSpacing;\n      previousWidth = currentWidth;\n    }\n  }\n\n  updateStyle(style) {\n    for (let key in style) {\n      let newKey = this.camelCase(key);\n      if (newKey === \"color\") newKey = \"fill\";\n\n      this.style[newKey] = style[key];\n    }\n  }\n\n  camelCase(name) {\n    const SPECIAL_CHARS_REGEXP = /([\\:\\-\\_]+(.))/g;\n    const MOZ_HACK_REGEXP = /^moz([A-Z])/;\n\n    return name\n      .replace(SPECIAL_CHARS_REGEXP, function(_, separator, letter, offset) {\n        return offset ? letter.toUpperCase() : letter;\n      })\n      .replace(MOZ_HACK_REGEXP, \"Moz$1\");\n  }\n\n  updateTexture() {\n    const canvas = this.canvas;\n\n    if (this._style.trim) {\n      const trimmed = trimCanvas(canvas);\n\n      if (trimmed.data) {\n        canvas.width = trimmed.width;\n        canvas.height = trimmed.height;\n        this.context.putImageData(trimmed.data, 0, 0);\n      }\n    }\n\n    const texture = this._texture;\n    const style = this._style;\n    const padding = style.trim ? 0 : style.padding;\n    const baseTexture = texture.baseTexture;\n\n    baseTexture.hasLoaded = true;\n    baseTexture.resolution = this.resolution;\n\n    baseTexture.realWidth = canvas.width;\n    baseTexture.realHeight = canvas.height;\n    baseTexture.width = canvas.width / this.resolution;\n    baseTexture.height = canvas.height / this.resolution;\n\n    texture.trim.width = texture._frame.width = canvas.width / this.resolution;\n    texture.trim.height = texture._frame.height =\n      canvas.height / this.resolution;\n    texture.trim.x = -padding;\n    texture.trim.y = -padding;\n\n    texture.orig.width = texture._frame.width - padding * 2;\n    texture.orig.height = texture._frame.height - padding * 2;\n\n    // call sprite onTextureUpdate to update scale if _width or _height were set\n    this._onTextureUpdate();\n    baseTexture.emit(\"update\", baseTexture);\n    this.dirty = false;\n  }\n\n  renderWebGL(renderer) {\n    if (this.resolution !== renderer.resolution) {\n      this.resolution = renderer.resolution;\n      this.dirty = true;\n    }\n\n    this.updateText(true);\n    super.renderWebGL(renderer);\n  }\n\n  _renderCanvas(renderer) {\n    if (this.resolution !== renderer.resolution) {\n      this.resolution = renderer.resolution;\n      this.dirty = true;\n    }\n\n    this.updateText(true);\n    super._renderCanvas(renderer);\n  }\n\n  getLocalBounds(rect) {\n    this.updateText(true);\n    return super.getLocalBounds.call(this, rect);\n  }\n\n  _calculateBounds() {\n    this.updateText(true);\n    this.calculateVertices();\n    // if we have already done this on THIS frame.\n    this._bounds.addQuad(this.vertexData);\n  }\n\n  _onStyleChange() {\n    this.dirty = true;\n  }\n\n  _generateFillStyle(style, lines) {\n    if (!Array.isArray(style.fill)) {\n      return style.fill;\n    }\n\n    let gradient;\n    let totalIterations;\n    let currentIteration;\n    let stop;\n\n    const width = this.canvas.width / this.resolution;\n    const height = this.canvas.height / this.resolution;\n    const fill = style.fill.slice();\n    const fillGradientStops = style.fillGradientStops.slice();\n\n    if (!fillGradientStops.length) {\n      const lengthPlus1 = fill.length + 1;\n\n      for (let i = 1; i < lengthPlus1; ++i) {\n        fillGradientStops.push(i / lengthPlus1);\n      }\n    }\n\n    fill.unshift(style.fill[0]);\n    fillGradientStops.unshift(0);\n\n    fill.push(style.fill[style.fill.length - 1]);\n    fillGradientStops.push(1);\n\n    if (style.fillGradientType === TEXT_GRADIENT.LINEAR_VERTICAL) {\n      gradient = this.context.createLinearGradient(\n        width / 2,\n        0,\n        width / 2,\n        height\n      );\n\n      totalIterations = (fill.length + 1) * lines.length;\n      currentIteration = 0;\n      for (let i = 0; i < lines.length; i++) {\n        currentIteration += 1;\n        for (let j = 0; j < fill.length; j++) {\n          if (typeof fillGradientStops[j] === \"number\") {\n            stop = fillGradientStops[j] / lines.length + i / lines.length;\n          } else {\n            stop = currentIteration / totalIterations;\n          }\n          gradient.addColorStop(stop, fill[j]);\n          currentIteration++;\n        }\n      }\n    } else {\n      gradient = this.context.createLinearGradient(\n        0,\n        height / 2,\n        width,\n        height / 2\n      );\n\n      totalIterations = fill.length + 1;\n      currentIteration = 1;\n\n      for (let i = 0; i < fill.length; i++) {\n        if (typeof fillGradientStops[i] === \"number\") {\n          stop = fillGradientStops[i];\n        } else {\n          stop = currentIteration / totalIterations;\n        }\n        gradient.addColorStop(stop, fill[i]);\n        currentIteration++;\n      }\n    }\n\n    return gradient;\n  }\n\n  destroy(options) {\n    if (this.destroyed) return;\n\n    if (typeof options === \"boolean\") {\n      options = { children: options };\n    }\n\n    options = Object.assign({}, defaultDestroyOptions, options);\n    super.destroy(options);\n    this.context = null;\n    this.canvas = null;\n    this._style = null;\n  }\n\n  get width() {\n    this.updateText(true);\n    return Math.abs(this.scale.x) * this._texture.orig.width;\n  }\n\n  set width(value) {\n    this.updateText(true);\n    const s = sign(this.scale.x) || 1;\n    this.scale.x = (s * value) / this._texture.orig.width;\n    this._width = value;\n  }\n\n  get height() {\n    this.updateText(true);\n    return Math.abs(this.scale.y) * this._texture.orig.height;\n  }\n\n  set height(value) {\n    this.updateText(true);\n    const s = sign(this.scale.y) || 1;\n    this.scale.y = (s * value) / this._texture.orig.height;\n    this._height = value;\n  }\n\n  get font() {\n    return this._font;\n  }\n\n  get style() {\n    return this._style;\n  }\n\n  set style(style) {\n    style = style || {};\n\n    if (style instanceof TextStyle) {\n      this._style = style;\n    } else {\n      this._style = new TextStyle(style);\n    }\n\n    this.localStyleID = -1;\n    this.dirty = true;\n  }\n\n  get text() {\n    return this._text;\n  }\n\n  set text(text) {\n    text = String(\n      text === \"\" || text === null || text === undefined ? \" \" : text\n    );\n\n    if (this._text === text) return;\n    this._text = text;\n    this.dirty = true;\n  }\n}\n"],"file":"Text.js"}