{"version":3,"sources":["../../src/resource/Resource.js"],"names":["_noop","EMPTY_GIF","Resource","constructor","name","url","options","Error","_flags","setflag","STATUS_FLAGS","DATA_URL","indexOf","extension","_getExt","data","crossOrigin","timeout","loadType","_determineLoadType","xhrType","error","children","type","TYPE","UNKNOWN","progressChunk","_dequeue","_onLoadBinding","_elementTimer","metadata","onStart","Signal","onProgress","onComplete","onAfterMiddleware","_onComplete","bind","_onError","_onTimeout","_onXhrLoad","isDataUrl","hasflag","isComplete","COMPLETE","isLoading","LOADING","complete","_clearEvents","_finish","load","cb","setTimeout","once","dispatch","LOAD_TYPE","IMAGE","_loadImage","XHR","_loadOtherFile","abort","message","src","firstChild","removeChild","destroy","removeHandler","isNetWork","_isNetWork","isBrowser","_loadXhr","_loadLocalFile","err","body","JSON","parse","superagent","get","end","res","test","flag","value","onerror","onload","clearTimeout","PsImage","network","event","e","LOAD_TYPE_MAP","ext","slashIndex","substring","queryStart","hashStart","index","Math","min","length","lastIndexOf","toLowerCase","setExtensionLoadType","extname","setExtMap","setExtensionXhrType","XHR_TYPE_MAP","XML","AUDIO","VIDEO","TEXT","map","val"],"mappings":"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","sourcesContent":["import { readFile } from \"fs\";\nimport Signal from \"mini-signals\";\nimport superagent from \"superagent\";\nimport PsImage from \"../polyfill/Image\";\nimport { isBrowser } from \"browser-or-node\";\nimport {\n  STATUS_FLAGS,\n  LOAD_TYPE,\n  XHR_TYPE_MAP,\n  LOAD_TYPE_MAP\n} from \"./constant\";\n\nfunction _noop() {}\nconst EMPTY_GIF =\n  \"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\";\n\nexport default class Resource {\n  constructor(name, url, options = {}) {\n    if (typeof name !== \"string\" || typeof url !== \"string\") {\n      throw new Error(\"Both name and url are required.\");\n    }\n\n    this._flags = 0;\n    this.setflag(STATUS_FLAGS.DATA_URL, url.indexOf(\"data:\") === 0);\n\n    this.name = name;\n    this.url = url;\n    this.extension = this._getExt();\n    this.data = null;\n    this.crossOrigin =\n      options.crossOrigin === true ? \"anonymous\" : options.crossOrigin;\n\n    this.timeout = options.timeout || 0;\n    this.loadType = options.loadType || this._determineLoadType();\n    this.xhrType = options.xhrType;\n\n    this.error = null;\n    this.children = [];\n    this.type = Resource.TYPE.UNKNOWN;\n    this.progressChunk = 0;\n    this._dequeue = _noop;\n    this._onLoadBinding = null;\n    this._elementTimer = 0;\n\n    this.metadata = options.metadata || {};\n    this.onStart = new Signal();\n    this.onProgress = new Signal();\n    this.onComplete = new Signal();\n    this.onAfterMiddleware = new Signal();\n\n    this._onComplete = this._onComplete.bind(this);\n    this._onError = this._onError.bind(this);\n    this._onTimeout = this._onTimeout.bind(this);\n    this._onXhrLoad = this._onXhrLoad.bind(this);\n  }\n\n  get isDataUrl() {\n    return this.hasflag(STATUS_FLAGS.DATA_URL);\n  }\n\n  get isComplete() {\n    return this.hasflag(STATUS_FLAGS.COMPLETE);\n  }\n\n  get isLoading() {\n    return this.hasflag(STATUS_FLAGS.LOADING);\n  }\n\n  complete() {\n    this._clearEvents();\n    this._finish();\n  }\n\n  load(cb) {\n    const { isLoading, loadType, isComplete } = this;\n\n    if (isLoading) return;\n    if (isComplete) {\n      if (cb) setTimeout(() => cb(this), 1);\n      return;\n    } else if (cb) {\n      this.onComplete.once(cb);\n    }\n\n    this.setflag(STATUS_FLAGS.LOADING, true);\n    this.onStart.dispatch(this);\n\n    switch (loadType) {\n      case LOAD_TYPE.IMAGE:\n        this.type = Resource.TYPE.IMAGE;\n        this._loadImage();\n        break;\n\n      case LOAD_TYPE.XHR:\n      default:\n        this._loadOtherFile();\n        break;\n    }\n  }\n\n  abort(message) {\n    if (this.error) return;\n    this.error = new Error(message);\n    this._clearEvents();\n\n    if (this.data) {\n      // single source\n      if (this.data.src) {\n        this.data.src = EMPTY_GIF;\n      }\n\n      // multi-source\n      else {\n        while (this.data.firstChild) {\n          this.data.removeChild(this.data.firstChild);\n        }\n      }\n    }\n\n    this._finish();\n  }\n\n  destroy() {\n    this.removeHandler();\n    this.data = null;\n    this.name = null;\n    this.url = null;\n    this.metadata = null;\n    this.onStart = null;\n    this.onProgress = null;\n    this.onComplete = null;\n    this.onAfterMiddleware = null;\n\n    this.children = null;\n    this._dequeue = null;\n    this._onLoadBinding = null;\n    this._flags = 0;\n    this._onComplete = null;\n    this._onError = null;\n    this._onTimeout = null;\n    this._onXhrLoad = null;\n  }\n\n  _loadOtherFile() {\n    const isNetWork = this._isNetWork(this.url);\n    if (isNetWork || isBrowser) {\n      this._loadXhr();\n    } else {\n      this._loadLocalFile();\n    }\n  }\n\n  _loadLocalFile() {\n    readFile(this.url, (err, data) => {\n      if (err) {\n        this._onError(err);\n      } else {\n        const body = JSON.parse(data);\n        this._onXhrLoad(body);\n      }\n    });\n  }\n\n  _loadXhr() {\n    superagent.get(this.url).end((err, res) => {\n      if (err) {\n        this._onError(err);\n      } else {\n        this._onXhrLoad(res.body);\n      }\n    });\n  }\n\n  _isNetWork(url) {\n    if (/^\\s*https?:\\/\\//.test(url)) return true;\n    return false;\n  }\n\n  _onXhrLoad(data) {\n    this.data = data;\n    this.type = Resource.TYPE.JSON;\n    this.complete();\n  }\n\n  hasflag(flag) {\n    return (this._flags & flag) !== 0;\n  }\n\n  setflag(flag, value) {\n    this._flags = value ? this._flags | flag : this._flags & ~flag;\n  }\n\n  removeHandler() {\n    if (!this.data) return;\n    this.data.onerror = null;\n    this.data.onload = null;\n  }\n\n  _clearEvents() {\n    clearTimeout(this._elementTimer);\n    this.removeHandler();\n  }\n\n  _finish() {\n    if (this.isComplete) return;\n    this.setflag(STATUS_FLAGS.COMPLETE, true);\n    this.setflag(STATUS_FLAGS.LOADING, false);\n    this.onComplete.dispatch(this);\n  }\n\n  _loadImage() {\n    this.data = new PsImage();\n    this.data.onerror = this._onError;\n    this.data.onload = this._onComplete;\n    if (this.crossOrigin) this.data.crossOrigin = this.crossOrigin;\n\n    this.data.src = this.url;\n    if (this._isNetWork(this.url)) {\n      this.data.network = true;\n    } else {\n      this.data.network = false;\n    }\n\n    if (this.timeout) {\n      this._elementTimer = setTimeout(this._onTimeout, this.timeout);\n    }\n  }\n\n  _onError(event) {\n    this.abort(`Failed to load element using: ${event}`);\n  }\n\n  _onTimeout() {\n    this.abort(`Load timed out.`);\n  }\n\n  _onComplete(e) {\n    this.complete();\n  }\n\n  _determineLoadType() {\n    return LOAD_TYPE_MAP[this.extension] || LOAD_TYPE.XHR;\n  }\n\n  _getExt() {\n    let url = this.url;\n    let ext = \"\";\n\n    if (this.isDataUrl) {\n      const slashIndex = url.indexOf(\"/\");\n      ext = url.substring(slashIndex + 1, url.indexOf(\";\", slashIndex));\n    } else {\n      const queryStart = url.indexOf(\"?\");\n      const hashStart = url.indexOf(\"#\");\n      const index = Math.min(\n        queryStart > -1 ? queryStart : url.length,\n        hashStart > -1 ? hashStart : url.length\n      );\n      url = url.substring(0, index);\n      ext = url.substring(url.lastIndexOf(\".\") + 1);\n    }\n\n    return ext.toLowerCase();\n  }\n\n  static setExtensionLoadType(extname, loadType) {\n    setExtMap(LOAD_TYPE_MAP, extname, loadType);\n  }\n\n  static setExtensionXhrType(extname, xhrType) {\n    setExtMap(XHR_TYPE_MAP, extname, xhrType);\n  }\n}\n\nResource.TYPE = {\n  UNKNOWN: 0,\n  JSON: 1,\n  XML: 2,\n  IMAGE: 3,\n  AUDIO: 4,\n  VIDEO: 5,\n  TEXT: 6\n};\n\nfunction setExtMap(map, extname, val) {\n  if (extname && extname.indexOf(\".\") === 0) {\n    extname = extname.substring(1);\n  }\n\n  if (!extname) {\n    return;\n  }\n\n  map[extname] = val;\n}\n"],"file":"Resource.js"}